<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Directorio de Autores</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />



<h:body class="bg-light">
<div class="container py-4">
  <h1 class="h3 mb-4">Directorio de Autores</h1>

  <!-- ===== FORMULARIO ===== -->
  <div class="card mb-4">
    <div class="card-body">
      <h2 class="h6 card-title mb-3">FORMULARIO DE AUTORES</h2>

      <h:form id="formAuthor">
        <div class="row g-3">

          <!-- Nombre -->
          <div class="col-12">
            <label class="form-label">Nombre del Autor:</label>
            <h:inputText id="name"
                         value="#{empty authorBean ? '' : authorBean.form.name}"
                         styleClass="form-control"
                         required="true"
                         requiredMessage="El nombre es obligatorio." />
          </div>






<!-- DOB -->
          <div class="col-12 col-md-6">
            <label class="form-label">Fecha de Nacimiento</label>
            <h:inputText id="birthdate"
                         value="#{empty authorBean ? '' : authorBean.form.birthdate}"
                         styleClass="form-control"
                         required="true"
                         requiredMessage="La fecha de nacimiento es obligatoria."
                         converterMessage="Formato de fecha inválido (dd/MM/yyyy)">
              <f:convertDateTime pattern="dd/MM/yyyy" />
            </h:inputText>
          </div>

          <!-- Validacion de numero -->
          <div class="col-12 col-md-6">
            <label class="form-label">Teléfono</label>
            <h:inputText id="phone"
                         value="#{empty authorBean ? '' : authorBean.form.phone}"
                         styleClass="form-control">
              <f:validator validatorId="svPhoneValidator" />
            </h:inputText>
          </div>

          <!-- Genero -->
          <div class="col-12">
            <label class="form-label">Género</label>
            <h:selectOneMenu id="genre"
                             value="#{empty authorBean ? '' : authorBean.form.genreId}"
                             styleClass="form-select">
              <f:selectItem itemLabel="Select" itemValue="" />
              <h:panelGroup rendered="#{not empty authorBean}">
                <f:selectItems value="#{authorBean.genres}" var="g" itemValue="#{g.id}" itemLabel="#{g.name}" />
              </h:panelGroup>
            </h:selectOneMenu>
          </div>

          <!-- agregar -->
          <div class="col-12 text-center">
            <h:commandButton value="AGREGAR"
                             action="#{authorBean.add}"
                             styleClass="btn btn-dark px-4" />
          </div>

          <!-- Validacion -->
          <div class="col-12">
            <label class="form-label">Validaciones</label>
            <div class="validation-box border rounded p-3 bg-body-tertiary">
              <h:messages id="msgs" layout="list"
                          infoClass="text-success mb-1"
                          warnClass="text-warning mb-1"
                          errorClass="text-danger mb-1"
                          fatalClass="text-danger fw-bold mb-1"/>
              <!-- Error duplicado -->
              <h:panelGroup rendered="#{not empty authorBean and authorBean.duplicateAdded}">
                <div class="text-warning">Este autor ya existía y fue agregado nuevamente.</div>
              </h:panelGroup>
            </div>
          </div>

        </div>
      </h:form>
    </div>
  </div>

<!-- ===== Pestañas ===== -->
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h2 class="h6 m-0">DIRECTORIO DE AUTORES</h2>

    <!-- Filtro por genero  -->
    <h:form id="formGenre" styleClass="d-flex gap-2 align-items-center">
      <h:selectOneMenu id="genreFilter"
                       value="#{empty authorBean ? '' : authorBean.selectedGenreId}"
                       styleClass="form-select">
        <f:selectItem itemLabel="Género" itemValue="" />
        <h:panelGroup rendered="#{not empty authorBean}">
          <f:selectItems value="#{authorBean.genres}" var="g" itemValue="#{g.id}" itemLabel="#{g.name}" />
          <f:ajax listener="#{authorBean.onGenreChange}" render="tbl authorsCount" />
        </h:panelGroup>
      </h:selectOneMenu>
    </h:form>
  </div>

  <!-- Filtro por texto -->
  <div class="card mb-3">
    <div class="card-body">
      <h:form id="formSyncFilter" styleClass="row g-2 align-items-center">
        <div class="col-12 col-md">
          <h:inputText value="#{empty authorBean ? '' : authorBean.syncFilter}"
                       styleClass="form-control"
                       placeholder="Filtrar por nombre, teléfono..." />
        </div>
        <div class="col-12 col-md-auto">
          <h:commandButton value="Aplicar filtro"
                           action="#{authorBean.applySyncFilter}"
                           styleClass="btn btn-outline-secondary" />
        </div>
      </h:form>
    </div>
  </div>

  <!-- ===== TABLA ===== -->
  <h:form id="formTable">
    <h:panelGroup id="tbl">

